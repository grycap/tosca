tosca_definitions_version: tosca_simple_yaml_1_0

imports:
  - grycap_custom_types: https://raw.githubusercontent.com/grycap/tosca/main/custom_types.yaml

description: AI4EOSC Plants species classifier

metadata:
  template_name: AI4EOSC Plants species classifier
  template_version: "1.1.0"
  template_author: Miguel Caballer

topology_template:

  inputs:
    cpu:
      type: float
      description: Number of virtual cpus for the container
      default: 2.0
    gpu:
      type: integer
      description: Number of GPUs for the container
      default: 0
    memory:
      type: scalar-unit.size
      description: Memory size for the container
      default: 4 GB

    ai4eosc_model_image:
      type: string
      description: Docker image of the model to be deployed
      default: ai4oshub/plants-classification
      required: yes

    endpoint:
      type: string
      description: DNS name to access the GeoServer instance
      default: https://plants-ai4eosc

  node_templates:

    ai4eosc_app:
      type: tosca.nodes.Container.Application.Docker
      requirements:
        - host: ai4eosc_runtime
      artifacts:
        my_image:
          file: { get_input: ai4eosc_model_image }
          type: tosca.artifacts.Deployment.Image.Container.Docker

    # The properties of the runtime to host the container
    ai4eosc_runtime:
      type: tosca.nodes.Container.Runtime.Docker
      capabilities:
        host:
          properties:
            num_cpus: { get_input: cpu }
            num_gpus: { get_input: gpu }
            mem_size: { get_input: memory }
            publish_ports:
              - target: 5000
                endpoint: { get_input: endpoint }

  outputs:
    ai4eosc_app_url:
      value: { concat: [ get_attribute: [ ai4eosc_app, endpoints, 0 ], 'ui' ] }
